<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>잇북</title>
  <!-- css -->
  <link rel="stylesheet" href="/css/reset.css" />
  <link rel="stylesheet" href="/css/common.css" />
  <link rel="stylesheet" href="/css/font.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <link rel="stylesheet" href="./home.css">
  <link rel="stylesheet" href="/css/style.css">
  <!-- js -->
  <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script defer src="https://kit.fontawesome.com/9daa42bcef.js" crossorigin="anonymous"></script>

  <script defer type="module" src="/template/header.js"></script>
  <script defer src="/template/scroll-top-btn.js"></script>
  <script defer src="/template/footer.js"></script>
  <script defer src="./home.js"></script>

  <!-- favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
</head>

<body>
  <!-- 메인슬라이드 -->
  <div class="main01">
    <div class="swiper main-swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide slide01"></div>
        <div class="swiper-slide slide02"></div>
        <div class="swiper-slide slide03"></div>
      </div>
      <!-- <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div> -->
      <div class="swiper-pagination"></div>
    </div>
  </div>
  <div class="wrap">
    <div class="main-container">
      <!-- 신상품 -->
      <div class="main04 product">
        <h3>새로 나왔어요</h3>
        <div class="swiper new-swiper">
          <div class="swiper-wrapper" id="newSwiper"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>
      <div class="main04 product title-padding">
        <div class="main-banner">
          <a href="">
            <img src="/img/main_banner.jpg" alt="" />
          </a>
        </div>
        <h3>웹 개발 추천 도서</h3>
        <div class="b-list" id="bookList"></div>
      </div>
    </div>
    <button class="top-btn"></button>
  </div>
  <script>
    // 메인 swiper
var swiper = new Swiper(".main-swiper", {
  pagination: {
    el: ".swiper-pagination",
    clickable: true,
  },
  autoplay: {
    delay: 5000,
    disableOnInteraction: true,
  },
  loop: true,
});

// 신상품 swiper
var swiper = new Swiper(".new-swiper", {
  slidesPerView: 3,
  navigation: {
    nextEl: ".swiper-button-next",
    prevEl: ".swiper-button-prev",
  },
  // autoplay: {
  //   delay: 3000,
  //   disableOnInteraction: true
  // },
  breakpoints: {
    1: {
      slidesPerView: 1,
    },
    768: {
      slidesPerView: 3,
    },
  },
  loop: true,
});

// 상품 데이터 함수
const fetchProducts = async () => {
  try {
    const bookList = document.getElementById("bookList");
    const response = await fetch("/api/products");
    const data = await response.json();
    const sortedData = data.filter((book) => book.category === "웹");
    const addCommas = (number) =>
      number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

    const books = sortedData
      .map(
        (book) =>
          `<div class="list-box">
            <a href="/product/${book._id}">
              <div class="img-wrap">
                <img src=${book.imageUrl} alt="" />
              </div>
              <div class="info">
                <p class="cate">${book.category}</p>
                <p class="name">${book.title}</p>
                <p class="price">${addCommas(book.price)}원</p>
              </div>
            </a>
          </div>`
      )
      .join("");

    bookList.innerHTML = books;
    newProducts();
    categoryColor();
  } catch (error) {
    console.error("Error:", error);
  }
};

// 신상품 정렬
const newProducts = async () => {
  try {
    const newswiper = document.getElementById("newSwiper");
    const response = await fetch("/api/products");
    const data = await response.json();
    const sortedData = data.sort(
      (a, b) => new Date(a.createdAt) - new Date(b.createdAt)
    );
    const addCommas = (number) =>
      number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

    const books = sortedData
      .map(
        (book) =>
          `<div class="swiper-slide">
          <div class="b-list list02">
            <div class="list-box">
              <a href="/product/${book._id}">
                <div class="img-wrap">
                  <img src=${book.imageUrl} alt="" />
                </div>
                <div class="info">
                  <p class="cate">${book.category}</p>
                  <p class="name">${book.title}</p>
                  <p class="price">${addCommas(book.price)}원</p>
                </div>
              </a>
            </div>
          </div>
        </div>`
      )
      .reverse()
      .slice(0, 6)
      .join("");

    newswiper.innerHTML = books;
  } catch (error) {
    console.error("Error:", error);
  }
};

const categoryColor = async () => {
  try {
    const response = await fetch("/api/category");
    const products = await response.json();
    const cateList = document.getElementsByClassName("cate");

    Array.from(cateList).forEach((cate) => {
      const category = cate.textContent;
      const productCategory0 = products[0];
      const productCategory1 = products[1];
      const productCategory2 = products[2];
      const productCategory3 = products[3];
      const productCategory4 = products[4];
      const productCategory5 = products[5];

      if (category === productCategory0) {
        cate.classList.add("green");
      } else if (category === productCategory1) {
        cate.classList.add("orange");
      } else if (category === productCategory2) {
        cate.classList.add("blue");
      } else if (category === productCategory3) {
        cate.classList.add("pink");
      } else if (category === productCategory4) {
        cate.classList.add("purple");
      } else if (category === productCategory5) {
        cate.classList.add("navy");
      } else {
        cate.classList.add("red");
      }
    });
  } catch (error) {
    console.error("Error:", error);
  }
};

fetchProducts();
  </script>
</body>

</html>